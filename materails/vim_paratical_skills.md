# 第 10 章 复制与粘贴

Vim 操作的不是剪贴板，而是寄存器。

可以使用 `"{register}` 的方式指定要使用的寄存器，若不指定，Vim 使用默认的“无名寄存器”。

`d` 命令会把制定文本复制到寄存器，然后再从文档中删除。

Vim 中真正的删除操作，即只删除文本而不把文本复制到寄存器，是使用名为“黑洞”的寄存器。使用下划线 `_` 引用黑洞寄存器。如，`_d{motion}` 会执行纯粹的删除操作。当你只想删除文本却不想覆盖寄存器时，此命令很管用。

把当前单词复制到寄存器 `a` 中：`"ayiw`

把当前整行文本剪切至寄存器 `b` 中：`"bdd`

粘贴寄存器 `a` 中的文本：`"ap`

粘贴寄存器 `b` 中的文本：`"bp`

## 无名寄存器

用一个双引号 `"` 表示无名寄存器。

Vim 默认使用无名寄存器，所以 `p` 等同于 `""p` 命令。

无名寄存器总是缺省的。`x`、`s`、`d{motion}`、`c{motion}` 和 `y{motion}` 都会覆盖无名寄存器中的内容。可以通过加 `"{register}` 前缀来指定使用其他寄存器。

## 复制专用寄存器

`0` 号寄存器：`"0`。

仅当使用 `y{motion}` 时，`0` 号寄存器中的内容才会被覆盖，**此时，无名寄存器和 0 号寄存器中的内容相同。** 可以使用 `:reg` 查看这两个寄存器中的内容。

`x`、`s`、`c{motion}` 和 `d{motion}` 只会覆盖无名寄存器，不会覆盖 `0` 号寄存器。


练习：将下面代码中的 `somethingInTheWay` 改为 `collection`。

```
collection = getCollection();
process(somethingInTheWay, target);
```

方案一：

1. 假设光标此时位于单词 `collection` 上。复制该单词：`yiw`。
2. 移动光标至单词 `somethingInTheWay` 上，删除该单词：`diw`。
4. 粘贴 0 号寄存器中的文本：`"0p`。

方案二：

1. 假设光标此时位于单词 `collection` 上。复制该单词：`yiw`。
2. 移动光标至单词 `somethingInTheWay` 上，删除该单词并进入插入模式：`ciw`。 
3. 粘贴 0 号寄存器中的内容并退出插入模式：`<C-r>0<Esc>`。

`ciw` 带来的好处是，之后可以用点 `.` 命令重复将其他单词替换为 `collection`。

方案三，利用可视模式：

1. 假设光标此时位于单词 `collection` 上。复制该单词：`yiw`。
2. 移动光标至单词 `somethingInTheWay` 上，选中该单词：`viw`。
4. 粘贴无名寄存器中的文本：`p`。

注意，方案三中的第 1 步操作结束后，无名寄存器和 0 号寄存器中的内容相同；但第 3 步操作结束后，0 号寄存器中的内容不变，但无名寄存器中的内容会被替换为刚才高亮选中的文本，因为我们其实是对这些文本进行了删除操作。所以如果此时还想粘贴单词 `collection`，必须使用 `"0p`，否则粘贴的单词是 `somethingInTheWay`。

**小技巧：**

使用 `gv` 可重选上一次选中的文本呢。


## 查看寄存器中的内容

`:reg`


## 有名寄存器

Vim 提供了一组以 26 个英文小写字母命名的有名寄存器，这意味着可以剪切、复制、粘贴多达 26 段文本。

```
  "[a-z]d{motion}
  
  "[a-z]y{motion}
  
  "[a-z]p
```

用小写字母引用有名寄存器，会覆盖该寄存器的原有内容。而用大写字母的话，会将新内容添加到该寄存器的原有内容之后。

## Vim 与外部程序的复制粘贴

与系统剪贴板等效的寄存器：`"+`。

**将外部程序中用剪切或复制的文本粘贴到 Vim 中：**

- 在普通模式中使用：`"+p` 
- 在插入模式中使用：`<C-r>+`

**将 Vim 中复制或删除的文本捕获至剪贴板，以便用于其他应用程序：**

```
  "+y{motion}

  "+d{motion}

  "+x
```

**主剪贴板**

注意：先使用 `:version` 命令，在输出中查找 `xterm_clipboard` 关键字，其前缀如果是减号 `-` 则表示不支持此功能。

X11 视窗系统支持一种被称为主剪贴板（primary）的剪贴板，保存着上次被高亮选中的文本，可以用鼠标中键粘贴出来。

Vim 的星号 `*` 寄存器对应主剪贴板。

```
  "*p
  <C-r>*
```

## 只读寄存器

|  Register |Meaning |
|      - | - |
|  `"%`|  当前文件名 |
|  `"#`|  轮换文件名 |
|  `".`|  上次插入的文本 |
|  `":`|  上次执行的 Ex 命令 |
|  `"/`|  上次查找的模式 |

## 利用可视模式交换文本内容

将下面一行文本中的 chips 和 fish 互换位置。

```
    I like chips and fish.
```

假设光标此时位于字母 `I` 上：

- `fc`，移动光标至字母 `c`
- `de`，删除单词 `chips`，不含结尾的空格
- `mm`，标记当前位置到字母 `m`
- `ww`，移动光标至字母 `f`
- `ve`，切换到可视模式，并高亮至单词 `fish` 的结尾
- `p`，粘贴无名寄存器中刚刚删除的单词
- `` m` ``，返回刚才标记的位置
- `P`，大写的 `P`，粘贴，将无名寄存器中刚才替换掉的单词

## p 与 gp，P 与 gP

`p` 和 `P` 后，光标会位于所粘贴的全部文本的第一行第一个字母，`gp` 与 `gP` 后，光标会位于所粘贴的全部文本的下一行，所以 `gp` 和 `gP` 可能更实用。


